{"version":3,"file":"webbluetooth.umd.js","sources":["../node_modules/rollup-plugin-node-builtins/src/es6/events.js","../src/helpers.ts","../src/dispatcher.ts","../src/adapter.ts","../node_modules/rollup-plugin-node-builtins/src/es6/os.js","../src/descriptor.ts","../src/events.ts","../src/characteristic.ts","../src/service.ts","../src/server.ts","../src/device.ts","../src/bluetooth.ts","../src/index.ts"],"sourcesContent":["'use strict';\n\nvar domain;\n\n// This constructor is used to store event handlers. Instantiating this is\n// faster than explicitly calling `Object.create(null)` to get a \"clean\" empty\n// object (tested with v8 v4.9).\nfunction EventHandlers() {}\nEventHandlers.prototype = Object.create(null);\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nexport default EventEmitter;\nexport {EventEmitter};\n\n// nodejs oddity\n// require('events') === require('events').EventEmitter\nEventEmitter.EventEmitter = EventEmitter\n\nEventEmitter.usingDomains = false;\n\nEventEmitter.prototype.domain = undefined;\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\nEventEmitter.init = function() {\n  this.domain = null;\n  if (EventEmitter.usingDomains) {\n    // if there is an active domain, then attach to it.\n    if (domain.active && !(this instanceof domain.Domain)) {\n      this.domain = domain.active;\n    }\n  }\n\n  if (!this._events || this._events === Object.getPrototypeOf(this)._events) {\n    this._events = new EventHandlers();\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || isNaN(n))\n    throw new TypeError('\"n\" argument must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nfunction $getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return $getMaxListeners(this);\n};\n\n// These standalone emit* functions are used to optimize calling of event\n// handlers for fast cases because emit() itself often has a variable number of\n// arguments and can be deoptimized because of that. These functions always have\n// the same number of arguments and thus do not get deoptimized, so the code\n// inside them can execute faster.\nfunction emitNone(handler, isFn, self) {\n  if (isFn)\n    handler.call(self);\n  else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      listeners[i].call(self);\n  }\n}\nfunction emitOne(handler, isFn, self, arg1) {\n  if (isFn)\n    handler.call(self, arg1);\n  else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      listeners[i].call(self, arg1);\n  }\n}\nfunction emitTwo(handler, isFn, self, arg1, arg2) {\n  if (isFn)\n    handler.call(self, arg1, arg2);\n  else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      listeners[i].call(self, arg1, arg2);\n  }\n}\nfunction emitThree(handler, isFn, self, arg1, arg2, arg3) {\n  if (isFn)\n    handler.call(self, arg1, arg2, arg3);\n  else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      listeners[i].call(self, arg1, arg2, arg3);\n  }\n}\n\nfunction emitMany(handler, isFn, self, args) {\n  if (isFn)\n    handler.apply(self, args);\n  else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      listeners[i].apply(self, args);\n  }\n}\n\nEventEmitter.prototype.emit = function emit(type) {\n  var er, handler, len, args, i, events, domain;\n  var needDomainExit = false;\n  var doError = (type === 'error');\n\n  events = this._events;\n  if (events)\n    doError = (doError && events.error == null);\n  else if (!doError)\n    return false;\n\n  domain = this.domain;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    er = arguments[1];\n    if (domain) {\n      if (!er)\n        er = new Error('Uncaught, unspecified \"error\" event');\n      er.domainEmitter = this;\n      er.domain = domain;\n      er.domainThrown = false;\n      domain.emit('error', er);\n    } else if (er instanceof Error) {\n      throw er; // Unhandled 'error' event\n    } else {\n      // At least give some kind of context to the user\n      var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n      err.context = er;\n      throw err;\n    }\n    return false;\n  }\n\n  handler = events[type];\n\n  if (!handler)\n    return false;\n\n  var isFn = typeof handler === 'function';\n  len = arguments.length;\n  switch (len) {\n    // fast cases\n    case 1:\n      emitNone(handler, isFn, this);\n      break;\n    case 2:\n      emitOne(handler, isFn, this, arguments[1]);\n      break;\n    case 3:\n      emitTwo(handler, isFn, this, arguments[1], arguments[2]);\n      break;\n    case 4:\n      emitThree(handler, isFn, this, arguments[1], arguments[2], arguments[3]);\n      break;\n    // slower\n    default:\n      args = new Array(len - 1);\n      for (i = 1; i < len; i++)\n        args[i - 1] = arguments[i];\n      emitMany(handler, isFn, this, args);\n  }\n\n  if (needDomainExit)\n    domain.exit();\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  if (typeof listener !== 'function')\n    throw new TypeError('\"listener\" argument must be a function');\n\n  events = target._events;\n  if (!events) {\n    events = target._events = new EventHandlers();\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (!existing) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] = prepend ? [listener, existing] :\n                                          [existing, listener];\n    } else {\n      // If we've already got an array, just append.\n      if (prepend) {\n        existing.unshift(listener);\n      } else {\n        existing.push(listener);\n      }\n    }\n\n    // Check for listener leak\n    if (!existing.warned) {\n      m = $getMaxListeners(target);\n      if (m && m > 0 && existing.length > m) {\n        existing.warned = true;\n        var w = new Error('Possible EventEmitter memory leak detected. ' +\n                            existing.length + ' ' + type + ' listeners added. ' +\n                            'Use emitter.setMaxListeners() to increase limit');\n        w.name = 'MaxListenersExceededWarning';\n        w.emitter = target;\n        w.type = type;\n        w.count = existing.length;\n        emitWarning(w);\n      }\n    }\n  }\n\n  return target;\n}\nfunction emitWarning(e) {\n  typeof console.warn === 'function' ? console.warn(e) : console.log(e);\n}\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction _onceWrap(target, type, listener) {\n  var fired = false;\n  function g() {\n    target.removeListener(type, g);\n    if (!fired) {\n      fired = true;\n      listener.apply(target, arguments);\n    }\n  }\n  g.listener = listener;\n  return g;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  if (typeof listener !== 'function')\n    throw new TypeError('\"listener\" argument must be a function');\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      if (typeof listener !== 'function')\n        throw new TypeError('\"listener\" argument must be a function');\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      if (typeof listener !== 'function')\n        throw new TypeError('\"listener\" argument must be a function');\n\n      events = this._events;\n      if (!events)\n        return this;\n\n      list = events[type];\n      if (!list)\n        return this;\n\n      if (list === listener || (list.listener && list.listener === listener)) {\n        if (--this._eventsCount === 0)\n          this._events = new EventHandlers();\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length; i-- > 0;) {\n          if (list[i] === listener ||\n              (list[i].listener && list[i].listener === listener)) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (list.length === 1) {\n          list[0] = undefined;\n          if (--this._eventsCount === 0) {\n            this._events = new EventHandlers();\n            return this;\n          } else {\n            delete events[type];\n          }\n        } else {\n          spliceOne(list, position);\n        }\n\n        if (events.removeListener)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events;\n\n      events = this._events;\n      if (!events)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (!events.removeListener) {\n        if (arguments.length === 0) {\n          this._events = new EventHandlers();\n          this._eventsCount = 0;\n        } else if (events[type]) {\n          if (--this._eventsCount === 0)\n            this._events = new EventHandlers();\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        for (var i = 0, key; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = new EventHandlers();\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners) {\n        // LIFO order\n        do {\n          this.removeListener(type, listeners[listeners.length - 1]);\n        } while (listeners[0]);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  var evlistener;\n  var ret;\n  var events = this._events;\n\n  if (!events)\n    ret = [];\n  else {\n    evlistener = events[type];\n    if (!evlistener)\n      ret = [];\n    else if (typeof evlistener === 'function')\n      ret = [evlistener.listener || evlistener];\n    else\n      ret = unwrapListeners(evlistener);\n  }\n\n  return ret;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? Reflect.ownKeys(this._events) : [];\n};\n\n// About 1.5x faster than the two-arg version of Array#splice().\nfunction spliceOne(list, index) {\n  for (var i = index, k = i + 1, n = list.length; k < n; i += 1, k += 1)\n    list[i] = list[k];\n  list.pop();\n}\n\nfunction arrayClone(arr, i) {\n  var copy = new Array(i);\n  while (i--)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n","/*\n* Node Web Bluetooth\n* Copyright (c) 2017 Rob Moran\n*\n* The MIT License (MIT)\n*\n* Permission is hereby granted, free of charge, to any person obtaining a copy\n* of this software and associated documentation files (the \"Software\"), to deal\n* in the Software without restriction, including without limitation the rights\n* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n* copies of the Software, and to permit persons to whom the Software is\n* furnished to do so, subject to the following conditions:\n*\n* The above copyright notice and this permission notice shall be included in all\n* copies or substantial portions of the Software.\n*\n* THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n* SOFTWARE.\n*/\n\n/**\n * Known services enum\n */\nexport enum bluetoothServices {\n    \"alert_notification\" = 0x1811,\n    \"automation_io\" = 0x1815,\n    \"battery_service\" = 0x180F,\n    \"blood_pressure\" = 0x1810,\n    \"body_composition\" = 0x181B,\n    \"bond_management\" = 0x181E,\n    \"continuous_glucose_monitoring\" = 0x181F,\n    \"current_time\" = 0x1805,\n    \"cycling_power\" = 0x1818,\n    \"cycling_speed_and_cadence\" = 0x1816,\n    \"device_information\" = 0x180A,\n    \"environmental_sensing\" = 0x181A,\n    \"generic_access\" = 0x1800,\n    \"generic_attribute\" = 0x1801,\n    \"glucose\" = 0x1808,\n    \"health_thermometer\" = 0x1809,\n    \"heart_rate\" = 0x180D,\n    \"human_interface_device\" = 0x1812,\n    \"immediate_alert\" = 0x1802,\n    \"indoor_positioning\" = 0x1821,\n    \"internet_protocol_support\" = 0x1820,\n    \"link_loss\" = 0x1803,\n    \"location_and_navigation\" = 0x1819,\n    \"next_dst_change\" = 0x1807,\n    \"phone_alert_status\" = 0x180E,\n    \"pulse_oximeter\" = 0x1822,\n    \"reference_time_update\" = 0x1806,\n    \"running_speed_and_cadence\" = 0x1814,\n    \"scan_parameters\" = 0x1813,\n    \"tx_power\" = 0x1804,\n    \"user_data\" = 0x181C,\n    \"weight_scale\" = 0x181D\n}\n\n/**\n * Known characteristics enum\n */\nexport enum bluetoothCharacteristics {\n    \"aerobic_heart_rate_lower_limit\" = 0x2A7E,\n    \"aerobic_heart_rate_upper_limit\" = 0x2A84,\n    \"aerobic_threshold\" = 0x2A7F,\n    \"age\" = 0x2A80,\n    \"aggregate\" = 0x2A5A,\n    \"alert_category_id\" = 0x2A43,\n    \"alert_category_id_bit_mask\" = 0x2A42,\n    \"alert_level\" = 0x2A06,\n    \"alert_notification_control_point\" = 0x2A44,\n    \"alert_status\" = 0x2A3F,\n    \"altitude\" = 0x2AB3,\n    \"anaerobic_heart_rate_lower_limit\" = 0x2A81,\n    \"anaerobic_heart_rate_upper_limit\" = 0x2A82,\n    \"anaerobic_threshold\" = 0x2A83,\n    \"analog\" = 0x2A58,\n    \"apparent_wind_direction\" = 0x2A73,\n    \"apparent_wind_speed\" = 0x2A72,\n    \"gap.appearance\" = 0x2A01,\n    \"barometric_pressure_trend\" = 0x2AA3,\n    \"battery_level\" = 0x2A19,\n    \"blood_pressure_feature\" = 0x2A49,\n    \"blood_pressure_measurement\" = 0x2A35,\n    \"body_composition_feature\" = 0x2A9B,\n    \"body_composition_measurement\" = 0x2A9C,\n    \"body_sensor_location\" = 0x2A38,\n    \"bond_management_control_point\" = 0x2AA4,\n    \"bond_management_feature\" = 0x2AA5,\n    \"boot_keyboard_input_report\" = 0x2A22,\n    \"boot_keyboard_output_report\" = 0x2A32,\n    \"boot_mouse_input_report\" = 0x2A33,\n    \"gap.central_address_resolution_support\" = 0x2AA6,\n    \"cgm_feature\" = 0x2AA8,\n    \"cgm_measurement\" = 0x2AA7,\n    \"cgm_session_run_time\" = 0x2AAB,\n    \"cgm_session_start_time\" = 0x2AAA,\n    \"cgm_specific_ops_control_point\" = 0x2AAC,\n    \"cgm_status\" = 0x2AA9,\n    \"csc_feature\" = 0x2A5C,\n    \"csc_measurement\" = 0x2A5B,\n    \"current_time\" = 0x2A2B,\n    \"cycling_power_control_point\" = 0x2A66,\n    \"cycling_power_feature\" = 0x2A65,\n    \"cycling_power_measurement\" = 0x2A63,\n    \"cycling_power_vector\" = 0x2A64,\n    \"database_change_increment\" = 0x2A99,\n    \"date_of_birth\" = 0x2A85,\n    \"date_of_threshold_assessment\" = 0x2A86,\n    \"date_time\" = 0x2A08,\n    \"day_date_time\" = 0x2A0A,\n    \"day_of_week\" = 0x2A09,\n    \"descriptor_value_changed\" = 0x2A7D,\n    \"gap.device_name\" = 0x2A00,\n    \"dew_point\" = 0x2A7B,\n    \"digital\" = 0x2A56,\n    \"dst_offset\" = 0x2A0D,\n    \"elevation\" = 0x2A6C,\n    \"email_address\" = 0x2A87,\n    \"exact_time_256\" = 0x2A0C,\n    \"fat_burn_heart_rate_lower_limit\" = 0x2A88,\n    \"fat_burn_heart_rate_upper_limit\" = 0x2A89,\n    \"firmware_revision_string\" = 0x2A26,\n    \"first_name\" = 0x2A8A,\n    \"five_zone_heart_rate_limits\" = 0x2A8B,\n    \"floor_number\" = 0x2AB2,\n    \"gender\" = 0x2A8C,\n    \"glucose_feature\" = 0x2A51,\n    \"glucose_measurement\" = 0x2A18,\n    \"glucose_measurement_context\" = 0x2A34,\n    \"gust_factor\" = 0x2A74,\n    \"hardware_revision_string\" = 0x2A27,\n    \"heart_rate_control_point\" = 0x2A39,\n    \"heart_rate_max\" = 0x2A8D,\n    \"heart_rate_measurement\" = 0x2A37,\n    \"heat_index\" = 0x2A7A,\n    \"height\" = 0x2A8E,\n    \"hid_control_point\" = 0x2A4C,\n    \"hid_information\" = 0x2A4A,\n    \"hip_circumference\" = 0x2A8F,\n    \"humidity\" = 0x2A6F,\n    \"ieee_11073-20601_regulatory_certification_data_list\" = 0x2A2A,\n    \"indoor_positioning_configuration\" = 0x2AAD,\n    \"intermediate_blood_pressure\" = 0x2A36,\n    \"intermediate_temperature\" = 0x2A1E,\n    \"irradiance\" = 0x2A77,\n    \"language\" = 0x2AA2,\n    \"last_name\" = 0x2A90,\n    \"latitude\" = 0x2AAE,\n    \"ln_control_point\" = 0x2A6B,\n    \"ln_feature\" = 0x2A6A,\n    \"local_east_coordinate.xml\" = 0x2AB1,\n    \"local_north_coordinate\" = 0x2AB0,\n    \"local_time_information\" = 0x2A0F,\n    \"location_and_speed\" = 0x2A67,\n    \"location_name\" = 0x2AB5,\n    \"longitude\" = 0x2AAF,\n    \"magnetic_declination\" = 0x2A2C,\n    \"magnetic_flux_density_2D\" = 0x2AA0,\n    \"magnetic_flux_density_3D\" = 0x2AA1,\n    \"manufacturer_name_string\" = 0x2A29,\n    \"maximum_recommended_heart_rate\" = 0x2A91,\n    \"measurement_interval\" = 0x2A21,\n    \"model_number_string\" = 0x2A24,\n    \"navigation\" = 0x2A68,\n    \"new_alert\" = 0x2A46,\n    \"gap.peripheral_preferred_connection_parameters\" = 0x2A04,\n    \"gap.peripheral_privacy_flag\" = 0x2A02,\n    \"plx_continuous_measurement\" = 0x2A5F,\n    \"plx_features\" = 0x2A60,\n    \"plx_spot_check_measurement\" = 0x2A5E,\n    \"pnp_id\" = 0x2A50,\n    \"pollen_concentration\" = 0x2A75,\n    \"position_quality\" = 0x2A69,\n    \"pressure\" = 0x2A6D,\n    \"protocol_mode\" = 0x2A4E,\n    \"rainfall\" = 0x2A78,\n    \"gap.reconnection_address\" = 0x2A03,\n    \"record_access_control_point\" = 0x2A52,\n    \"reference_time_information\" = 0x2A14,\n    \"report\" = 0x2A4D,\n    \"report_map\" = 0x2A4B,\n    \"resting_heart_rate\" = 0x2A92,\n    \"ringer_control_point\" = 0x2A40,\n    \"ringer_setting\" = 0x2A41,\n    \"rsc_feature\" = 0x2A54,\n    \"rsc_measurement\" = 0x2A53,\n    \"sc_control_point\" = 0x2A55,\n    \"scan_interval_window\" = 0x2A4F,\n    \"scan_refresh\" = 0x2A31,\n    \"sensor_location\" = 0x2A5D,\n    \"serial_number_string\" = 0x2A25,\n    \"gatt.service_changed\" = 0x2A05,\n    \"software_revision_string\" = 0x2A28,\n    \"sport_type_for_aerobic_and_anaerobic_thresholds\" = 0x2A93,\n    \"supported_new_alert_category\" = 0x2A47,\n    \"supported_unread_alert_category\" = 0x2A48,\n    \"system_id\" = 0x2A23,\n    \"temperature\" = 0x2A6E,\n    \"temperature_measurement\" = 0x2A1C,\n    \"temperature_type\" = 0x2A1D,\n    \"three_zone_heart_rate_limits\" = 0x2A94,\n    \"time_accuracy\" = 0x2A12,\n    \"time_source\" = 0x2A13,\n    \"time_update_control_point\" = 0x2A16,\n    \"time_update_state\" = 0x2A17,\n    \"time_with_dst\" = 0x2A11,\n    \"time_zone\" = 0x2A0E,\n    \"true_wind_direction\" = 0x2A71,\n    \"true_wind_speed\" = 0x2A70,\n    \"two_zone_heart_rate_limit\" = 0x2A95,\n    \"tx_power_level\" = 0x2A07,\n    \"uncertainty\" = 0x2AB4,\n    \"unread_alert_status\" = 0x2A45,\n    \"user_control_point\" = 0x2A9F,\n    \"user_index\" = 0x2A9A,\n    \"uv_index\" = 0x2A76,\n    \"vo2_max\" = 0x2A96,\n    \"waist_circumference\" = 0x2A97,\n    \"weight\" = 0x2A98,\n    \"weight_measurement\" = 0x2A9D,\n    \"weight_scale_feature\" = 0x2A9E,\n    \"wind_chill\" = 0x2A79\n}\n\n/**\n * Known descriptors enum\n */\nexport enum bluetoothDescriptors {\n    \"gatt.characteristic_extended_properties\" = 0x2900,\n    \"gatt.characteristic_user_description\" = 0x2901,\n    \"gatt.client_characteristic_configuration\" = 0x2902,\n    \"gatt.server_characteristic_configuration\" = 0x2903,\n    \"gatt.characteristic_presentation_format\" = 0x2904,\n    \"gatt.characteristic_aggregate_format\" = 0x2905,\n    \"valid_range\" = 0x2906,\n    \"external_report_reference\" = 0x2907,\n    \"report_reference\" = 0x2908,\n    \"number_of_digitals\" = 0x2909,\n    \"value_trigger_setting\" = 0x290A,\n    \"es_configuration\" = 0x290B,\n    \"es_measurement\" = 0x290C,\n    \"es_trigger_setting\" = 0x290D,\n    \"time_trigger_setting\" = 0x290E\n}\n\n/**\n * Gets a canonical UUID from a partial UUID in string or hex format\n * @param uuid The partial UUID\n * @returns canonical UUID\n */\nexport function getCanonicalUUID(uuid: string | number): string {\n    if (typeof uuid === \"number\") uuid = uuid.toString(16);\n    uuid = uuid.toLowerCase();\n    if (uuid.length <= 8) uuid = (\"00000000\" + uuid).slice(-8) + \"-0000-1000-8000-00805f9b34fb\";\n    if (uuid.length === 32) uuid = uuid.match(/^([0-9a-f]{8})([0-9a-f]{4})([0-9a-f]{4})([0-9a-f]{4})([0-9a-f]{12})$/).splice(1).join(\"-\");\n    return uuid;\n}\n\n/**\n * Gets a canonical service UUID from a known service name or partial UUID in string or hex format\n * @param service The known service name\n * @returns canonical UUID\n */\nexport function getServiceUUID(service: string | number): string {\n    // Check for string as enums also allow a reverse lookup which will match any numbers passed in\n    if (typeof service === \"string\" && bluetoothServices[service]) {\n        service = bluetoothServices[service];\n    }\n\n    return getCanonicalUUID(service);\n}\n\n/**\n * Gets a canonical characteristic UUID from a known characteristic name or partial UUID in string or hex format\n * @param characteristic The known characteristic name\n * @returns canonical UUID\n */\nexport function getCharacteristicUUID(characteristic: string | number): string {\n    // Check for string as enums also allow a reverse lookup which will match any numbers passed in\n    if (typeof characteristic === \"string\" && bluetoothCharacteristics[characteristic]) {\n        characteristic = bluetoothCharacteristics[characteristic];\n    }\n\n    return getCanonicalUUID(characteristic);\n}\n\n/**\n * Gets a canonical descriptor UUID from a known descriptor name or partial UUID in string or hex format\n * @param descriptor The known descriptor name\n * @returns canonical UUID\n */\nexport function getDescriptorUUID(descriptor: string | number): string {\n    // Check for string as enums also allow a reverse lookup which will match any numbers passed in\n    if (typeof descriptor === \"string\" && bluetoothDescriptors[descriptor]) {\n        descriptor = bluetoothDescriptors[descriptor];\n    }\n\n    return getCanonicalUUID(descriptor);\n}\n","/*\n* Node Web Bluetooth\n* Copyright (c) 2019 Rob Moran\n*\n* The MIT License (MIT)\n*\n* Permission is hereby granted, free of charge, to any person obtaining a copy\n* of this software and associated documentation files (the \"Software\"), to deal\n* in the Software without restriction, including without limitation the rights\n* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n* copies of the Software, and to permit persons to whom the Software is\n* furnished to do so, subject to the following conditions:\n*\n* The above copyright notice and this permission notice shall be included in all\n* copies or substantial portions of the Software.\n*\n* THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n* SOFTWARE.\n*/\n\nimport { EventEmitter } from \"events\";\n\n// tslint:disable:ban-types\n\n/**\n * @hidden\n */\nexport interface EventListeners<T> {\n    newListener: keyof T;\n    removeListener: keyof T;\n}\n\n/**\n * @hidden\n */\nexport interface TypedDispatcher<T> {\n    addEventListener<K extends keyof T>(type: K, listener: (this: this, event: T[K]) => void): void;\n    addEventListener<E extends keyof EventListeners<T>>(type: E, listener: (this: this, event: EventListeners<T>[E]) => void): void;\n    removeEventListener<K extends keyof T>(type: K, callback: (this: this, event: T[K]) => void): void;\n    removeEventListener<E extends keyof EventListeners<T>>(type: E, callback: (this: this, event: EventListeners<T>[E]) => void): void;\n    dispatchEvent<K extends keyof T>(event: T[K]): boolean;\n    addListener<K extends keyof T>(event: K, listener: (data: T[K]) => void): this;\n    addListener<E extends keyof EventListeners<T>>(event: E, listener: (data: EventListeners<T>[E]) => void): this;\n    on<K extends keyof T>(event: K, listener: (data: T[K]) => void): this;\n    on<E extends keyof EventListeners<T>>(event: E, listener: (data: EventListeners<T>[E]) => void): this;\n    once<K extends keyof T>(event: K, listener: (data: T[K]) => void): this;\n    once<E extends keyof EventListeners<T>>(event: E, listener: (data: EventListeners<T>[E]) => void): this;\n    prependListener<K extends keyof T>(event: K, listener: (data: T[K]) => void): this;\n    prependOnceListener<K extends keyof T>(event: K, listener: (data: T[K]) => void): this;\n    removeListener<K extends keyof T>(event: K, listener: (data: T[K]) => void): this;\n    removeListener<E extends keyof EventListeners<T>>(event: E, listener: (data: EventListeners<T>[E]) => void): this;\n    removeAllListeners<K extends keyof T>(event?: K): this;\n    removeAllListeners<E extends keyof EventListeners<T>>(event?: E): this;\n    listeners<K extends keyof T>(event: K): Array<Function>;\n    listeners<E extends keyof EventListeners<T>>(event: EventListeners<T>[E]): Array<Function>;\n    emit<K extends keyof T>(event: K, data: T[K]): boolean;\n    eventNames<K extends keyof T, E extends keyof EventListeners<T>>(): Array<K | E>;\n    listenerCount<K extends keyof T>(type: K): number;\n    listenerCount<E extends keyof EventListeners<T>>(type: EventListeners<T>[E]): number;\n    setMaxListeners(n: number): this;\n    getMaxListeners(): number;\n}\n\n/**\n * @hidden\n */\nexport class EventDispatcher extends EventEmitter implements EventTarget {\n\n    private isEventListenerObject = (listener: EventListenerOrEventListenerObject): listener is EventListenerObject => (listener as EventListenerObject).handleEvent !== undefined;\n\n    public addEventListener(type: string, listener: EventListenerOrEventListenerObject | null) {\n        if (listener) {\n            const handler = this.isEventListenerObject(listener) ? listener.handleEvent : listener;\n            super.addListener(type, handler);\n        }\n    }\n\n    public removeEventListener(type: string, callback: EventListenerOrEventListenerObject | null) {\n        if (callback) {\n            const handler = this.isEventListenerObject(callback) ? callback.handleEvent : callback;\n            super.removeListener(type, handler);\n        }\n    }\n\n    public dispatchEvent(event: Event): boolean {\n        return super.emit(event.type, event);\n    }\n}\n","/*\n* Node Web Bluetooth\n* Copyright (c) 2017 Rob Moran\n*\n* The MIT License (MIT)\n*\n* Permission is hereby granted, free of charge, to any person obtaining a copy\n* of this software and associated documentation files (the \"Software\"), to deal\n* in the Software without restriction, including without limitation the rights\n* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n* copies of the Software, and to permit persons to whom the Software is\n* furnished to do so, subject to the following conditions:\n*\n* The above copyright notice and this permission notice shall be included in all\n* copies or substantial portions of the Software.\n*\n* THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n* SOFTWARE.\n*/\n\nimport { platform } from \"os\";\nimport { EventEmitter } from \"events\";\nimport { getCanonicalUUID } from \"./helpers\";\nimport { BluetoothDevice } from \"./device\";\nimport { BluetoothRemoteGATTService } from \"./service\";\nimport { BluetoothRemoteGATTCharacteristic } from \"./characteristic\";\nimport * as noble from \"@abandonware/noble\";\n\n/**\n * @hidden\n */\nexport interface Adapter extends EventEmitter {\n    getEnabled: (completeFn: (enabled: boolean) => void) => void;\n    startScan: (serviceUUIDs: Array<string>, foundFn: (device: Partial<BluetoothDevice>) => void, completeFn?: () => void, errorFn?: (errorMsg: string) => void) => void;\n    stopScan: (errorFn?: (errorMsg: string) => void) => void;\n    connect: (handle: string, connectFn: () => void, disconnectFn: () => void,\terrorFn?: (errorMsg: string) => void) => void;\n    disconnect: (handle: string, errorFn?: (errorMsg: string) => void) => void;\n    discoverServices: (handle: string, serviceUUIDs: Array<string>, completeFn: (services: Array<Partial<BluetoothRemoteGATTService>>) => void, errorFn?: (errorMsg: string) => void) => void;\n    discoverIncludedServices: (handle: string, serviceUUIDs: Array<string>, completeFn: (services: Array<Partial<BluetoothRemoteGATTService>>) => void, errorFn?: (errorMsg: string) => void) => void;\n    discoverCharacteristics: (handle: string, characteristicUUIDs: Array<string>, completeFn: (characteristics: Array<Partial<BluetoothRemoteGATTCharacteristic>>) => void, errorFn?: (errorMsg: string) => void) => void;\n    discoverDescriptors: (handle: string, descriptorUUIDs: Array<string>, completeFn: (descriptors: Array<Partial<BluetoothRemoteGATTDescriptor>>) => void, errorFn?: (errorMsg: string) => void) => void;\n    readCharacteristic: (handle: string, completeFn: (value: DataView) => void, errorFn?: (errorMsg: string) => void) => void;\n    writeCharacteristic: (handle: string, value: DataView, completeFn?: () => void, errorFn?: (errorMsg: string) => void, withoutResponse?: boolean) => void;\n    enableNotify: (handle: string, notifyFn: () => void, completeFn?: () => void, errorFn?: (errorMsg: string) => void) => void;\n    disableNotify: (handle: string, completeFn?: () => void, errorFn?: (errorMsg: string) => void) => void;\n    readDescriptor: (handle: string, completeFn: (value: DataView) => void, errorFn?: (errorMsg: string) => void) => void;\n    writeDescriptor: (handle: string, value: DataView, completeFn?: () => void, errorFn?: (errorMsg: string) => void) => void;\n}\n\n/**\n * @hidden\n */\nexport class NobleAdapter extends EventEmitter implements Adapter {\n\n    public static EVENT_ENABLED: string = \"enabledchanged\";\n\n    private deviceHandles: {} = {};\n    private serviceHandles: {} = {};\n    private characteristicHandles: {} = {};\n    private descriptorHandles: {} = {};\n    private charNotifies: {} = {};\n    private discoverFn: (device: noble.Peripheral) => void = null;\n    private initialised: boolean = false;\n    private enabled: boolean = false;\n    private os: string = platform();\n\n    constructor() {\n        super();\n        this.enabled = this.state;\n        noble.on(\"stateChange\", () => {\n            if (this.enabled !== this.state) {\n                this.enabled = this.state;\n                this.emit(NobleAdapter.EVENT_ENABLED, this.enabled);\n            }\n        });\n    }\n\n    private get state(): boolean {\n        return (noble.state === \"poweredOn\");\n    }\n\n    private init(completeFn: () => any): void {\n        if (this.initialised) return completeFn();\n        noble.on(\"discover\", deviceInfo => {\n            if (this.discoverFn) this.discoverFn(deviceInfo);\n        });\n        this.initialised = true;\n        completeFn();\n    }\n\n    private checkForError(errorFn, continueFn?, delay?: number) {\n        return function(error) {\n            if (error) errorFn(error);\n            else if (typeof continueFn === \"function\") {\n                const args = [].slice.call(arguments, 1);\n                if (delay === null) continueFn.apply(this, args);\n                else setTimeout(() => continueFn.apply(this, args), delay);\n            }\n        };\n    }\n\n    private bufferToDataView(buffer: Buffer): DataView {\n        // Buffer to ArrayBuffer\n        const arrayBuffer = new Uint8Array(buffer).buffer;\n        return new DataView(arrayBuffer);\n    }\n\n    private dataViewToBuffer(dataView: DataView): Buffer {\n        // DataView to TypedArray\n        const typedArray = new Uint8Array(dataView.buffer);\n        return new Buffer(typedArray);\n    }\n\n    private validDevice(deviceInfo: noble.Peripheral, serviceUUIDs: Array<string>): boolean {\n        if (serviceUUIDs.length === 0) {\n            // Match any device\n            return true;\n        }\n\n        if (!deviceInfo.advertisement.serviceUuids) {\n            // No advertised services, no match\n            return false;\n        }\n\n        const advertisedUUIDs = deviceInfo.advertisement.serviceUuids.map(serviceUUID => {\n            return getCanonicalUUID(serviceUUID);\n        });\n\n        return serviceUUIDs.some(serviceUUID => {\n            // An advertised UUID matches our search UUIDs\n            return (advertisedUUIDs.indexOf(serviceUUID) >= 0);\n        });\n    }\n\n    private deviceToBluetoothDevice(deviceInfo): Partial<BluetoothDevice> {\n        const deviceID = (deviceInfo.address && deviceInfo.address !== \"unknown\") ? deviceInfo.address : deviceInfo.id;\n\n        const serviceUUIDs = [];\n        if (deviceInfo.advertisement.serviceUuids) {\n            deviceInfo.advertisement.serviceUuids.forEach(serviceUUID => {\n                serviceUUIDs.push(getCanonicalUUID(serviceUUID));\n            });\n        }\n\n        const manufacturerData = new Map();\n        if (deviceInfo.advertisement.manufacturerData) {\n            // First 2 bytes are 16-bit company identifier\n            const company = deviceInfo.advertisement.manufacturerData.readUInt16LE(0);\n\n            // Remove company ID\n            const buffer = deviceInfo.advertisement.manufacturerData.slice(2);\n            manufacturerData.set((\"0000\" + company.toString(16)).slice(-4), this.bufferToDataView(buffer));\n        }\n\n        const serviceData = new Map();\n        if (deviceInfo.advertisement.serviceData) {\n            deviceInfo.advertisement.serviceData.forEach(serviceAdvert => {\n                serviceData.set(getCanonicalUUID(serviceAdvert.uuid), this.bufferToDataView(serviceAdvert.data));\n            });\n        }\n\n        return {\n            id: deviceID,\n            name: deviceInfo.advertisement.localName,\n            _serviceUUIDs: serviceUUIDs,\n            adData: {\n                rssi: deviceInfo.rssi,\n                txPower: deviceInfo.advertisement.txPowerLevel,\n                serviceData: serviceData,\n                manufacturerData: manufacturerData\n            }\n        };\n    }\n\n    public getEnabled(completeFn: (enabled: boolean) => void) {\n        function stateCB() {\n            completeFn(this.state);\n        }\n\n        if (noble.state === \"unknown\" || noble.state === \"poweredOff\") {\n            // tslint:disable-next-line:no-string-literal\n            noble[\"once\"](\"stateChange\", stateCB.bind(this));\n        } else {\n            stateCB.call(this);\n        }\n    }\n\n    public startScan(serviceUUIDs: Array<string>, foundFn: (device: Partial<BluetoothDevice>) => void, completeFn?: () => void, errorFn?: (errorMsg: string) => void): void {\n\n        this.discoverFn = deviceInfo => {\n            if (this.validDevice(deviceInfo, serviceUUIDs)) {\n                const device = this.deviceToBluetoothDevice(deviceInfo);\n\n                if (!this.deviceHandles[device.id]) {\n                    this.deviceHandles[device.id] = deviceInfo;\n                    // Only call the found function the first time we find a valid device\n                    foundFn(device);\n                }\n            }\n        };\n\n        this.init(() => {\n            this.deviceHandles = {};\n            function stateCB() {\n                if (this.state === true) {\n                    // Noble doesn't correctly match short and canonical UUIDs on Linux, so we need to check ourselves\n                    // Continually scan to pick up all advertised UUIDs\n                    noble.startScanning([], true, this.checkForError(errorFn, completeFn));\n                } else {\n                    errorFn(\"adapter not enabled\");\n                }\n            }\n\n            if (noble.state === \"unknown\" || noble.state === \"poweredOff\") {\n                // tslint:disable-next-line:no-string-literal\n                noble[\"once\"](\"stateChange\", stateCB.bind(this));\n            } else {\n                stateCB.call(this);\n            }\n        });\n    }\n\n    public stopScan(_errorFn?: (errorMsg: string) => void): void {\n        this.discoverFn = null;\n        noble.stopScanning();\n    }\n\n    public connect(handle: string, connectFn: () => void, disconnectFn: () => void, errorFn?: (errorMsg: string) => void): void {\n        const baseDevice = this.deviceHandles[handle];\n        baseDevice.removeAllListeners(\"connect\");\n        baseDevice.removeAllListeners(\"disconnect\");\n        baseDevice.once(\"connect\", connectFn);\n        baseDevice.once(\"disconnect\", () => {\n            this.serviceHandles = {};\n            this.characteristicHandles = {};\n            this.descriptorHandles = {};\n            this.charNotifies = {};\n            disconnectFn();\n        });\n        baseDevice.connect(this.checkForError(errorFn));\n    }\n\n    public disconnect(handle: string, errorFn?: (errorMsg: string) => void): void {\n        const baseDevice = this.deviceHandles[handle];\n        baseDevice.disconnect(this.checkForError(errorFn));\n    }\n\n    public discoverServices(handle: string, serviceUUIDs: Array<string>, completeFn: (services: Array<Partial<BluetoothRemoteGATTService>>) => void, errorFn?: (errorMsg: string) => void): void {\n        const baseDevice = this.deviceHandles[handle];\n        baseDevice.discoverServices([], this.checkForError(errorFn, services => {\n            const discovered = [];\n            services.forEach(serviceInfo => {\n                const serviceUUID = getCanonicalUUID(serviceInfo.uuid);\n\n                if (serviceUUIDs.length === 0 || serviceUUIDs.indexOf(serviceUUID) >= 0) {\n                    if (!this.serviceHandles[serviceUUID]) this.serviceHandles[serviceUUID] = serviceInfo;\n\n                    discovered.push({\n                        uuid: serviceUUID,\n                        primary: true\n                    });\n                }\n            });\n\n            completeFn(discovered);\n        }));\n    }\n\n    public discoverIncludedServices(handle: string, serviceUUIDs: Array<string>, completeFn: (services: Array<Partial<BluetoothRemoteGATTService>>) => void, errorFn?: (errorMsg: string) => void): void {\n        const serviceInfo = this.serviceHandles[handle];\n        serviceInfo.discoverIncludedServices([], this.checkForError(errorFn, services => {\n\n            const discovered = [];\n            services.forEach(service => {\n                const serviceUUID = getCanonicalUUID(service.uuid);\n\n                if (serviceUUIDs.length === 0 || serviceUUIDs.indexOf(serviceUUID) >= 0) {\n                    if (!this.serviceHandles[serviceUUID]) this.serviceHandles[serviceUUID] = service;\n\n                    discovered.push({\n                        uuid: serviceUUID,\n                        primary: false\n                    });\n                }\n            }, this);\n\n            completeFn(discovered);\n        }));\n    }\n\n    public discoverCharacteristics(handle: string, characteristicUUIDs: Array<string>, completeFn: (characteristics: Array<Partial<BluetoothRemoteGATTCharacteristic>>) => void, errorFn?: (errorMsg: string) => void): void {\n        const serviceInfo = this.serviceHandles[handle];\n        serviceInfo.discoverCharacteristics([], this.checkForError(errorFn, characteristics => {\n\n            const discovered = [];\n            characteristics.forEach(characteristicInfo => {\n                const charUUID = getCanonicalUUID(characteristicInfo.uuid);\n\n                if (characteristicUUIDs.length === 0 || characteristicUUIDs.indexOf(charUUID) >= 0) {\n                    if (!this.characteristicHandles[charUUID]) this.characteristicHandles[charUUID] = characteristicInfo;\n\n                    discovered.push({\n                        uuid: charUUID,\n                        properties: {\n                            broadcast:                  (characteristicInfo.properties.indexOf(\"broadcast\") >= 0),\n                            read:                       (characteristicInfo.properties.indexOf(\"read\") >= 0),\n                            writeWithoutResponse:       (characteristicInfo.properties.indexOf(\"writeWithoutResponse\") >= 0),\n                            write:                      (characteristicInfo.properties.indexOf(\"write\") >= 0),\n                            notify:                     (characteristicInfo.properties.indexOf(\"notify\") >= 0),\n                            indicate:                   (characteristicInfo.properties.indexOf(\"indicate\") >= 0),\n                            authenticatedSignedWrites:  (characteristicInfo.properties.indexOf(\"authenticatedSignedWrites\") >= 0),\n                            reliableWrite:              (characteristicInfo.properties.indexOf(\"reliableWrite\") >= 0),\n                            writableAuxiliaries:        (characteristicInfo.properties.indexOf(\"writableAuxiliaries\") >= 0)\n                        }\n                    });\n\n                    characteristicInfo.on(\"data\", (data, isNotification) => {\n                        if (isNotification === true && typeof this.charNotifies[charUUID] === \"function\") {\n                            const dataView = this.bufferToDataView(data);\n                            this.charNotifies[charUUID](dataView);\n                        }\n                    });\n                }\n            }, this);\n\n            completeFn(discovered);\n        }));\n    }\n\n    public discoverDescriptors(handle: string, descriptorUUIDs: Array<string>, completeFn: (descriptors: Array<Partial<BluetoothRemoteGATTDescriptor>>) => void, errorFn?: (errorMsg: string) => void): void {\n        const characteristicInfo = this.characteristicHandles[handle];\n        characteristicInfo.discoverDescriptors(this.checkForError(errorFn, descriptors => {\n\n            const discovered = [];\n            descriptors.forEach(descriptorInfo => {\n                const descUUID = getCanonicalUUID(descriptorInfo.uuid);\n\n                if (descriptorUUIDs.length === 0 || descriptorUUIDs.indexOf(descUUID) >= 0) {\n                    const descHandle = characteristicInfo.uuid + \"-\" + descriptorInfo.uuid;\n                    if (!this.descriptorHandles[descHandle]) this.descriptorHandles[descHandle] = descriptorInfo;\n\n                    discovered.push({\n                        uuid: descUUID\n                    });\n                }\n            }, this);\n\n            completeFn(discovered);\n        }));\n    }\n\n    public readCharacteristic(handle: string, completeFn: (value: DataView) => void, errorFn?: (errorMsg: string) => void): void {\n        this.characteristicHandles[handle].read(this.checkForError(errorFn, data => {\n            const dataView = this.bufferToDataView(data);\n            completeFn(dataView);\n        }));\n    }\n\n    public writeCharacteristic(handle: string, value: DataView, completeFn?: () => void, errorFn?: (errorMsg: string) => void, withoutResponse?: boolean): void {\n        const buffer = this.dataViewToBuffer(value);\n        const characteristic = this.characteristicHandles[handle];\n\n        if (withoutResponse === undefined) {\n            // writeWithoutResponse and authenticatedSignedWrites don't require a response\n            withoutResponse = characteristic.properties.indexOf(\"writeWithoutResponse\") >= 0\n                           || characteristic.properties.indexOf(\"authenticatedSignedWrites\") >= 0;\n        }\n\n        // Add a small delay for writing without response when not on MacOS\n        const delay = (this.os !== \"darwin\" && withoutResponse) ? 25 : null;\n\n        characteristic.write(buffer, withoutResponse, this.checkForError(errorFn, completeFn, delay));\n    }\n\n    public enableNotify(handle: string, notifyFn: (value: DataView) => void, completeFn?: () => void, errorFn?: (errorMsg: string) => void): void {\n        if (this.charNotifies[handle]) {\n            this.charNotifies[handle] = notifyFn;\n            return completeFn();\n        }\n        this.characteristicHandles[handle].once(\"notify\", state => {\n            if (state !== true) return errorFn(\"notify failed to enable\");\n            this.charNotifies[handle] = notifyFn;\n            completeFn();\n        });\n        this.characteristicHandles[handle].notify(true, this.checkForError(errorFn));\n    }\n\n    public disableNotify(handle: string, completeFn?: () => void, errorFn?: (errorMsg: string) => void): void {\n        if (!this.charNotifies[handle]) {\n            return completeFn();\n        }\n        this.characteristicHandles[handle].once(\"notify\", state => {\n            if (state !== false) return errorFn(\"notify failed to disable\");\n            if (this.charNotifies[handle]) delete this.charNotifies[handle];\n            completeFn();\n        });\n        this.characteristicHandles[handle].notify(false, this.checkForError(errorFn));\n    }\n\n    public readDescriptor(handle: string, completeFn: (value: DataView) => void, errorFn?: (errorMsg: string) => void): void {\n        this.descriptorHandles[handle].readValue(this.checkForError(errorFn, data => {\n            const dataView = this.bufferToDataView(data);\n            completeFn(dataView);\n        }));\n    }\n\n    public writeDescriptor(handle: string, value: DataView, completeFn?: () => void, errorFn?: (errorMsg: string) => void): void {\n        const buffer = this.dataViewToBuffer(value);\n        this.descriptorHandles[handle].writeValue(buffer, this.checkForError(errorFn, completeFn));\n    }\n}\n\n/**\n * @hidden\n */\nexport const adapter = new NobleAdapter();\n","/*\nThe MIT License (MIT)\n\nCopyright (c) 2016 CoderPuppy\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n\n*/\nvar _endianness;\nexport function endianness() {\n  if (typeof _endianness === 'undefined') {\n    var a = new ArrayBuffer(2);\n    var b = new Uint8Array(a);\n    var c = new Uint16Array(a);\n    b[0] = 1;\n    b[1] = 2;\n    if (c[0] === 258) {\n      _endianness = 'BE';\n    } else if (c[0] === 513){\n      _endianness = 'LE';\n    } else {\n      throw new Error('unable to figure out endianess');\n    }\n  }\n  return _endianness;\n}\n\nexport function hostname() {\n  if (typeof global.location !== 'undefined') {\n    return global.location.hostname\n  } else return '';\n}\n\nexport function loadavg() {\n  return [];\n}\n\nexport function uptime() {\n  return 0;\n}\n\nexport function freemem() {\n  return Number.MAX_VALUE;\n}\n\nexport function totalmem() {\n  return Number.MAX_VALUE;\n}\n\nexport function cpus() {\n  return [];\n}\n\nexport function type() {\n  return 'Browser';\n}\n\nexport function release () {\n  if (typeof global.navigator !== 'undefined') {\n    return global.navigator.appVersion;\n  }\n  return '';\n}\n\nexport function networkInterfaces(){}\nexport function getNetworkInterfaces(){}\n\nexport function arch() {\n  return 'javascript';\n}\n\nexport function platform() {\n  return 'browser';\n}\n\nexport function tmpDir() {\n  return '/tmp';\n}\nexport var tmpdir = tmpDir;\n\nexport var EOL = '\\n';\nexport default {\n  EOL: EOL,\n  tmpdir: tmpdir,\n  tmpDir: tmpDir,\n  networkInterfaces:networkInterfaces,\n  getNetworkInterfaces: getNetworkInterfaces,\n  release: release,\n  type: type,\n  cpus: cpus,\n  totalmem: totalmem,\n  freemem: freemem,\n  uptime: uptime,\n  loadavg: loadavg,\n  hostname: hostname,\n  endianness: endianness,\n}\n","/*\n* Node Web Bluetooth\n* Copyright (c) 2017 Rob Moran\n*\n* The MIT License (MIT)\n*\n* Permission is hereby granted, free of charge, to any person obtaining a copy\n* of this software and associated documentation files (the \"Software\"), to deal\n* in the Software without restriction, including without limitation the rights\n* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n* copies of the Software, and to permit persons to whom the Software is\n* furnished to do so, subject to the following conditions:\n*\n* The above copyright notice and this permission notice shall be included in all\n* copies or substantial portions of the Software.\n*\n* THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n* SOFTWARE.\n*/\n\nimport { adapter } from \"./adapter\";\nimport { W3CBluetoothRemoteGATTDescriptor } from \"./interfaces\";\n\n/**\n * Bluetooth Remote GATT Descriptor class\n */\nexport class BluetoothRemoteGATTDescriptor implements W3CBluetoothRemoteGATTDescriptor {\n\n    /**\n     * The characteristic the descriptor is related to\n     */\n    public readonly characteristic: BluetoothRemoteGATTCharacteristic = null;\n\n    /**\n     * The unique identifier of the descriptor\n     */\n    public readonly uuid: string = null;\n\n    private _value: DataView = null;\n    /**\n     * The value of the descriptor\n     */\n    public get value(): DataView {\n        return this._value;\n    }\n\n    private handle: string = null;\n\n    /**\n     * Descriptor constructor\n     * @param init A partial class to initialise values\n     */\n    constructor(init: Partial<BluetoothRemoteGATTDescriptor>) {\n        this.characteristic = init.characteristic;\n        this.uuid = init.uuid;\n        this._value = init.value;\n\n        this.handle = `${this.characteristic.uuid}-${this.uuid}`;\n    }\n\n    /**\n     * Gets the value of the descriptor\n     * @returns Promise containing the value\n     */\n    public readValue(): Promise<DataView> {\n        return new Promise((resolve, reject) =>  {\n            if (!this.characteristic.service.device.gatt.connected) return reject(\"readValue error: device not connected\");\n\n            adapter.readDescriptor(this.handle, dataView => {\n                this._value = dataView;\n                resolve(dataView);\n            }, error => {\n                reject(`readValue error: ${error}`);\n            });\n        });\n    }\n\n    /**\n     * Updates the value of the descriptor\n     * @param value The value to write\n     */\n    public writeValue(value: ArrayBuffer | ArrayBufferView): Promise<void> {\n        return new Promise((resolve, reject) => {\n            if (!this.characteristic.service.device.gatt.connected) return reject(\"writeValue error: device not connected\");\n\n            function isView(source: ArrayBuffer | ArrayBufferView): source is ArrayBufferView {\n                return (source as ArrayBufferView).buffer !== undefined;\n            }\n\n            const arrayBuffer = isView(value) ? value.buffer : value;\n            const dataView = new DataView(arrayBuffer);\n\n            adapter.writeDescriptor(this.handle, dataView, () => {\n                this._value = dataView;\n                resolve();\n            }, error => {\n                reject(`writeValue error: ${error}`);\n            });\n        });\n    }\n}\n","/*\n* Node Web Bluetooth\n* Copyright (c) 2019 Rob Moran\n*\n* The MIT License (MIT)\n*\n* Permission is hereby granted, free of charge, to any person obtaining a copy\n* of this software and associated documentation files (the \"Software\"), to deal\n* in the Software without restriction, including without limitation the rights\n* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n* copies of the Software, and to permit persons to whom the Software is\n* furnished to do so, subject to the following conditions:\n*\n* The above copyright notice and this permission notice shall be included in all\n* copies or substantial portions of the Software.\n*\n* THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n* SOFTWARE.\n*/\n\n/**\n * @hidden\n */\nexport class DOMEvent implements Event {\n\n    /**\n     * Type of the event\n     */\n    public type: string;\n\n    /**\n     * @hidden\n     */\n    public target: EventTarget;\n\n    /**\n     * @hidden\n     */\n    public currentTarget: EventTarget;\n\n    /**\n     * @hidden\n     */\n    public srcElement: EventTarget;\n\n    /**\n     * @hidden\n     */\n    public timeStamp: number;\n\n    /**\n     * @hidden\n     */\n    public bubbles = true;\n\n    /**\n     * @hidden\n     */\n    public cancelable = false;\n\n    /**\n     * @hidden\n     */\n    public cancelBubble = false;\n\n    /**\n     * @hidden\n     */\n    public composed = false;\n\n    /**\n     * @hidden\n     */\n    public defaultPrevented = false;\n\n    /**\n     * @hidden\n     */\n    public eventPhase = 0;\n\n    /**\n     * @hidden\n     */\n    public isTrusted = true;\n\n    /**\n     * @hidden\n     */\n    public returnValue = true;\n\n    /**\n     * @hidden\n     */\n    public AT_TARGET: number;\n\n    /**\n     * @hidden\n     */\n    public BUBBLING_PHASE: number;\n\n    /**\n     * @hidden\n     */\n    public CAPTURING_PHASE: number;\n\n    /**\n     * @hidden\n     */\n    public NONE: number;\n\n    constructor(target: EventTarget, type: string) {\n        this.target = target;\n        this.srcElement = target;\n        this.currentTarget = target;\n        this.type = type;\n    }\n\n    /**\n     * @hidden\n     */\n    public composedPath(): Array<EventTarget> {\n        return [];\n    }\n\n    /**\n     * @hidden\n     */\n    public initEvent(type: string, bubbles?: boolean, cancelable?: boolean) {\n        this.type = type;\n        this.bubbles = bubbles;\n        this.cancelable = cancelable;\n    }\n\n    /**\n     * @hidden\n     */\n    public preventDefault() {\n        this.defaultPrevented = true;\n    }\n\n    /**\n     * @hidden\n     */\n    public stopImmediatePropagation() {\n        return;\n    }\n\n    /**\n     * @hidden\n     */\n    public stopPropagation() {\n        return;\n    }\n}\n","/*\n* Node Web Bluetooth\n* Copyright (c) 2017 Rob Moran\n*\n* The MIT License (MIT)\n*\n* Permission is hereby granted, free of charge, to any person obtaining a copy\n* of this software and associated documentation files (the \"Software\"), to deal\n* in the Software without restriction, including without limitation the rights\n* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n* copies of the Software, and to permit persons to whom the Software is\n* furnished to do so, subject to the following conditions:\n*\n* The above copyright notice and this permission notice shall be included in all\n* copies or substantial portions of the Software.\n*\n* THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n* SOFTWARE.\n*/\n\nimport { EventDispatcher, TypedDispatcher } from \"./dispatcher\";\nimport { BluetoothRemoteGATTService } from \"./service\";\nimport { BluetoothRemoteGATTDescriptor } from \"./descriptor\";\nimport { getDescriptorUUID } from \"./helpers\";\nimport { adapter } from \"./adapter\";\nimport { W3CBluetoothRemoteGATTCharacteristic } from \"./interfaces\";\nimport { DOMEvent } from \"./events\";\n\n/**\n * @hidden\n */\nexport interface BluetoothRemoteGATTCharacteristicEvents {\n    /**\n     * Characteristic value changed event\n     */\n    characteristicvaluechanged: Event;\n}\n\n/**\n * Bluetooth Remote GATT Characteristic class\n */\nexport class BluetoothRemoteGATTCharacteristic extends (EventDispatcher as new() => TypedDispatcher<BluetoothRemoteGATTCharacteristicEvents>) implements W3CBluetoothRemoteGATTCharacteristic {\n\n    /**\n     * The service the characteristic is related to\n     */\n    public readonly service: BluetoothRemoteGATTService = null;\n\n    /**\n     * The unique identifier of the characteristic\n     */\n    public readonly uuid = null;\n\n    /**\n     * The properties of the characteristic\n     */\n    public readonly properties: BluetoothCharacteristicProperties;\n\n    private _value: DataView = null;\n    /**\n     * The value of the characteristic\n     */\n    public get value(): DataView {\n        return this._value;\n    }\n\n    private handle: string = null;\n    private descriptors: Array<BluetoothRemoteGATTDescriptor> = null;\n\n    private _oncharacteristicvaluechanged: (ev: Event) => void;\n    public set oncharacteristicvaluechanged(fn: (ev: Event) => void) {\n        if (this._oncharacteristicvaluechanged) {\n            this.removeEventListener(\"characteristicvaluechanged\", this._oncharacteristicvaluechanged);\n        }\n        this._oncharacteristicvaluechanged = fn;\n        this.addEventListener(\"characteristicvaluechanged\", this._oncharacteristicvaluechanged);\n    }\n\n    /**\n     * Characteristic constructor\n     * @param init A partial class to initialise values\n     */\n    constructor(init: Partial<BluetoothRemoteGATTCharacteristic>) {\n        super();\n\n        this.service = init.service;\n        this.uuid = init.uuid;\n        this.properties = init.properties;\n        this._value = init.value;\n\n        this.handle = this.uuid;\n    }\n\n    private setValue(value?: DataView, emit?: boolean) {\n        this._value = value;\n        if (emit) {\n            this.dispatchEvent(new DOMEvent(this, \"characteristicvaluechanged\"));\n            this.service.dispatchEvent(new DOMEvent(this, \"characteristicvaluechanged\"));\n            this.service.device.dispatchEvent(new DOMEvent(this, \"characteristicvaluechanged\"));\n            this.service.device._bluetooth.dispatchEvent(new DOMEvent(this, \"characteristicvaluechanged\"));\n        }\n    }\n\n    /**\n     * Gets a single characteristic descriptor\n     * @param descriptor descriptor UUID\n     * @returns Promise containing the descriptor\n     */\n    public getDescriptor(descriptor: string | number): Promise<BluetoothRemoteGATTDescriptor> {\n        return new Promise((resolve, reject) => {\n            if (!this.service.device.gatt.connected) return reject(\"getDescriptor error: device not connected\");\n            if (!descriptor) return reject(\"getDescriptor error: no descriptor specified\");\n\n            this.getDescriptors(descriptor)\n            .then(descriptors => {\n                if (descriptors.length !== 1) return reject(\"getDescriptor error: descriptor not found\");\n                resolve(descriptors[0]);\n            })\n            .catch(error =>  {\n                reject(`getDescriptor error: ${error}`);\n            });\n        });\n    }\n\n    /**\n     * Gets a list of the characteristic's descriptors\n     * @param descriptor descriptor UUID\n     * @returns Promise containing an array of descriptors\n     */\n    public getDescriptors(descriptor?: string | number): Promise<Array<BluetoothRemoteGATTDescriptor>> {\n        return new Promise((resolve, reject) => {\n            if (!this.service.device.gatt.connected) return reject(\"getDescriptors error: device not connected\");\n\n            function complete() {\n                if (!descriptor) return resolve(this.descriptors);\n\n                const filtered = this.descriptors.filter(descriptorObject => {\n                    return (descriptorObject.uuid === getDescriptorUUID(descriptor));\n                });\n\n                if (filtered.length !== 1) return reject(\"getDescriptors error: descriptor not found\");\n                resolve(filtered);\n            }\n\n            if (this.descriptors) return complete.call(this);\n\n            adapter.discoverDescriptors(this.handle, [], descriptors => {\n                this.descriptors = descriptors.map(descriptorInfo => {\n                    Object.assign(descriptorInfo, {\n                        characteristic: this\n                    });\n                    return new BluetoothRemoteGATTDescriptor(descriptorInfo);\n                });\n\n                complete.call(this);\n            }, error => {\n                reject(`getDescriptors error: ${error}`);\n            });\n        });\n    }\n\n    /**\n     * Gets the value of the characteristic\n     * @returns Promise containing the value\n     */\n    public readValue(): Promise<DataView> {\n        return new Promise((resolve, reject) => {\n            if (!this.service.device.gatt.connected) return reject(\"readValue error: device not connected\");\n\n            adapter.readCharacteristic(this.handle, dataView => {\n                this.setValue(dataView, true);\n                resolve(dataView);\n            }, error => {\n                reject(`readValue error: ${error}`);\n            });\n        });\n    }\n\n    /**\n     * Updates the value of the characteristic\n     * @param value The value to write\n     */\n    public writeValue(value: ArrayBuffer | ArrayBufferView): Promise<void> {\n        return new Promise((resolve, reject) => {\n            if (!this.service.device.gatt.connected) return reject(\"writeValue error: device not connected\");\n\n            function isView(source: ArrayBuffer | ArrayBufferView): source is ArrayBufferView {\n                return (source as ArrayBufferView).buffer !== undefined;\n            }\n\n            const arrayBuffer = isView(value) ? value.buffer : value;\n            const dataView = new DataView(arrayBuffer);\n\n            adapter.writeCharacteristic(this.handle, dataView, () => {\n                this.setValue (dataView);\n                resolve();\n            }, error => {\n                reject(`writeValue error: ${error}`);\n            });\n        });\n    }\n\n    /**\n     * Updates the value of the characteristic and waits for a response\n     * @param value The value to write\n     */\n    public writeValueWithResponse(value: ArrayBuffer | ArrayBufferView): Promise<void> {\n        return new Promise((resolve, reject) => {\n            if (!this.service.device.gatt.connected) return reject(\"writeValue error: device not connected\");\n\n            function isView(source: ArrayBuffer | ArrayBufferView): source is ArrayBufferView {\n                return (source as ArrayBufferView).buffer !== undefined;\n            }\n\n            const arrayBuffer = isView(value) ? value.buffer : value;\n            const dataView = new DataView(arrayBuffer);\n\n            adapter.writeCharacteristic(this.handle, dataView, () => {\n                this.setValue (dataView);\n                resolve();\n            }, error => {\n                reject(`writeValue error: ${error}`);\n            }, false);\n        });\n    }\n\n    /**\n     * Updates the value of the characteristic without waiting for a response\n     * @param value The value to write\n     */\n    public writeValueWithoutResponse(value: ArrayBuffer | ArrayBufferView): Promise<void> {\n        return new Promise((resolve, reject) => {\n            if (!this.service.device.gatt.connected) return reject(\"writeValue error: device not connected\");\n\n            function isView(source: ArrayBuffer | ArrayBufferView): source is ArrayBufferView {\n                return (source as ArrayBufferView).buffer !== undefined;\n            }\n\n            const arrayBuffer = isView(value) ? value.buffer : value;\n            const dataView = new DataView(arrayBuffer);\n\n            adapter.writeCharacteristic(this.handle, dataView, () => {\n                this.setValue (dataView);\n                resolve();\n            }, error => {\n                reject(`writeValue error: ${error}`);\n            }, true);\n        });\n    }\n\n    /**\n     * Start notifications of changes for the characteristic\n     * @returns Promise containing the characteristic\n     */\n    public startNotifications(): Promise<W3CBluetoothRemoteGATTCharacteristic> {\n        return new Promise((resolve, reject) => {\n            if (!this.service.device.gatt.connected) return reject(\"startNotifications error: device not connected\");\n\n            adapter.enableNotify(this.handle, dataView => {\n                this.setValue(dataView, true);\n            }, () => {\n                resolve(this);\n            }, error => {\n                reject(`startNotifications error: ${error}`);\n            });\n        });\n    }\n\n    /**\n     * Stop notifications of changes for the characteristic\n     * @returns Promise containing the characteristic\n     */\n    public stopNotifications(): Promise<BluetoothRemoteGATTCharacteristic> {\n        return new Promise((resolve, reject) => {\n            if (!this.service.device.gatt.connected) return reject(\"stopNotifications error: device not connected\");\n\n            adapter.disableNotify(this.handle, () => {\n                resolve(this);\n            }, error => {\n                reject(`stopNotifications error: ${error}`);\n            });\n        });\n    }\n}\n","/*\n* Node Web Bluetooth\n* Copyright (c) 2017 Rob Moran\n*\n* The MIT License (MIT)\n*\n* Permission is hereby granted, free of charge, to any person obtaining a copy\n* of this software and associated documentation files (the \"Software\"), to deal\n* in the Software without restriction, including without limitation the rights\n* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n* copies of the Software, and to permit persons to whom the Software is\n* furnished to do so, subject to the following conditions:\n*\n* The above copyright notice and this permission notice shall be included in all\n* copies or substantial portions of the Software.\n*\n* THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n* SOFTWARE.\n*/\n\nimport { EventDispatcher, TypedDispatcher } from \"./dispatcher\";\nimport { BluetoothDevice } from \"./device\";\nimport { BluetoothRemoteGATTCharacteristic, BluetoothRemoteGATTCharacteristicEvents } from \"./characteristic\";\nimport { getCharacteristicUUID, getServiceUUID } from \"./helpers\";\nimport { adapter } from \"./adapter\";\nimport { W3CBluetoothRemoteGATTService } from \"./interfaces\";\nimport { DOMEvent } from \"./events\";\n\n/**\n * @hidden\n */\nexport interface BluetoothRemoteGATTServiceEvents extends BluetoothRemoteGATTCharacteristicEvents {\n    /**\n     * Service added event\n     */\n    serviceadded: Event;\n    /**\n     * Service changed event\n     */\n    servicechanged: Event;\n    /**\n     * Service removed event\n     */\n    serviceremoved: Event;\n}\n\n/**\n * Bluetooth Remote GATT Service class\n */\nexport class BluetoothRemoteGATTService extends (EventDispatcher as new() => TypedDispatcher<BluetoothRemoteGATTServiceEvents>) implements W3CBluetoothRemoteGATTService {\n\n    /**\n     * The device the service is related to\n     */\n    public readonly device: BluetoothDevice = null;\n\n    /**\n     * The unique identifier of the service\n     */\n    public readonly uuid: string = null;\n\n    /**\n     * Whether the service is a primary one\n     */\n    public readonly isPrimary: boolean = false;\n\n    private handle: string = null;\n    private services: Array<BluetoothRemoteGATTService> = null;\n    private characteristics: Array<BluetoothRemoteGATTCharacteristic> = null;\n\n    private _oncharacteristicvaluechanged: (ev: Event) => void;\n    public set oncharacteristicvaluechanged(fn: (ev: Event) => void) {\n        if (this._oncharacteristicvaluechanged) {\n            this.removeEventListener(\"characteristicvaluechanged\", this._oncharacteristicvaluechanged);\n        }\n        this._oncharacteristicvaluechanged = fn;\n        this.addEventListener(\"characteristicvaluechanged\", this._oncharacteristicvaluechanged);\n    }\n\n    private _onserviceadded: (ev: Event) => void;\n    public set onserviceadded(fn: (ev: Event) => void) {\n        if (this._onserviceadded) {\n            this.removeEventListener(\"serviceadded\", this._onserviceadded);\n        }\n        this._onserviceadded = fn;\n        this.addEventListener(\"serviceadded\", this._onserviceadded);\n    }\n\n    private _onservicechanged: (ev: Event) => void;\n    public set onservicechanged(fn: (ev: Event) => void) {\n        if (this._onservicechanged) {\n            this.removeEventListener(\"servicechanged\", this._onservicechanged);\n        }\n        this._onservicechanged = fn;\n        this.addEventListener(\"servicechanged\", this._onservicechanged);\n    }\n\n    private _onserviceremoved: (ev: Event) => void;\n    public set onserviceremoved(fn: (ev: Event) => void) {\n        if (this._onserviceremoved) {\n            this.removeEventListener(\"serviceremoved\", this._onserviceremoved);\n        }\n        this._onserviceremoved = fn;\n        this.addEventListener(\"serviceremoved\", this._onserviceremoved);\n    }\n\n    /**\n     * Service constructor\n     * @param init A partial class to initialise values\n     */\n    constructor(init: Partial<BluetoothRemoteGATTService>) {\n        super();\n\n        this.device = init.device;\n        this.uuid = init.uuid;\n        this.isPrimary = init.isPrimary;\n\n        this.handle = this.uuid;\n\n        this.dispatchEvent(new DOMEvent(this, \"serviceadded\"));\n        this.device.dispatchEvent(new DOMEvent(this, \"serviceadded\"));\n        this.device._bluetooth.dispatchEvent(new DOMEvent(this, \"serviceadded\"));\n    }\n\n    /**\n     * Gets a single characteristic contained in the service\n     * @param characteristic characteristic UUID\n     * @returns Promise containing the characteristic\n     */\n    public getCharacteristic(characteristic: string | number): Promise<BluetoothRemoteGATTCharacteristic> {\n        return new Promise((resolve, reject) => {\n            if (!this.device.gatt.connected) return reject(\"getCharacteristic error: device not connected\");\n            if (!characteristic) return reject(\"getCharacteristic error: no characteristic specified\");\n\n            this.getCharacteristics(characteristic)\n            .then(characteristics => {\n                if (characteristics.length !== 1) return reject(\"getCharacteristic error: characteristic not found\");\n                resolve(characteristics[0]);\n            })\n            .catch(error => {\n                reject(`getCharacteristic error: ${error}`);\n            });\n        });\n    }\n\n    /**\n     * Gets a list of characteristics contained in the service\n     * @param characteristic characteristic UUID\n     * @returns Promise containing an array of characteristics\n     */\n    public getCharacteristics(characteristic?: string | number): Promise<Array<BluetoothRemoteGATTCharacteristic>> {\n        return new Promise((resolve, reject) => {\n            if (!this.device.gatt.connected) return reject(\"getCharacteristics error: device not connected\");\n\n            function complete() {\n                if (!characteristic) return resolve(this.characteristics);\n\n                // Canonical-ize characteristic\n                characteristic = getCharacteristicUUID(characteristic);\n\n                const filtered = this.characteristics.filter(characteristicObject => {\n                    return (characteristicObject.uuid === characteristic);\n                });\n\n                if (filtered.length !== 1) return reject(\"getCharacteristics error: characteristic not found\");\n                resolve(filtered);\n            }\n\n            if (this.characteristics) return complete.call(this);\n\n            adapter.discoverCharacteristics(this.handle, [], characteristics => {\n                this.characteristics = characteristics.map(characteristicInfo => {\n                    Object.assign(characteristicInfo, {\n                        service: this\n                    });\n                    return new BluetoothRemoteGATTCharacteristic(characteristicInfo);\n                });\n\n                complete.call(this);\n            }, error => {\n                reject(`getCharacteristics error: ${error}`);\n            });\n        });\n    }\n\n    /**\n     * Gets a single service included in the service\n     * @param service service UUID\n     * @returns Promise containing the service\n     */\n    public getIncludedService(service: string | number): Promise<BluetoothRemoteGATTService> {\n        return new Promise((resolve, reject) => {\n            if (!this.device.gatt.connected) return reject(\"getIncludedService error: device not connected\");\n            if (!service) return reject(\"getIncludedService error: no service specified\");\n\n            this.getIncludedServices(service)\n            .then(services => {\n                if (services.length !== 1) return reject(\"getIncludedService error: service not found\");\n                resolve(services[0]);\n            })\n            .catch(error => {\n                reject(`getIncludedService error: ${error}`);\n            });\n        });\n    }\n\n    /**\n     * Gets a list of services included in the service\n     * @param service service UUID\n     * @returns Promise containing an array of services\n     */\n    public getIncludedServices(service?: string | number): Promise<Array<BluetoothRemoteGATTService>> {\n        return new Promise((resolve, reject) => {\n            if (!this.device.gatt.connected) return reject(\"getIncludedServices error: device not connected\");\n\n            function complete() {\n                if (!service) return resolve(this.services);\n\n                const filtered = this.services.filter(serviceObject => {\n                    return (serviceObject.uuid === getServiceUUID(service));\n                });\n\n                if (filtered.length !== 1) return reject(\"getIncludedServices error: service not found\");\n                resolve(filtered);\n            }\n\n            if (this.services) return complete.call(this);\n\n            adapter.discoverIncludedServices(this.handle, this.device._allowedServices, services => {\n                this.services = services.map(serviceInfo => {\n                    Object.assign(serviceInfo, {\n                        device: this.device\n                    });\n                    return new BluetoothRemoteGATTService(serviceInfo);\n                });\n\n                complete.call(this);\n            }, error => {\n                reject(`getIncludedServices error: ${error}`);\n            });\n        });\n    }\n}\n","/*\n* Node Web Bluetooth\n* Copyright (c) 2017 Rob Moran\n*\n* The MIT License (MIT)\n*\n* Permission is hereby granted, free of charge, to any person obtaining a copy\n* of this software and associated documentation files (the \"Software\"), to deal\n* in the Software without restriction, including without limitation the rights\n* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n* copies of the Software, and to permit persons to whom the Software is\n* furnished to do so, subject to the following conditions:\n*\n* The above copyright notice and this permission notice shall be included in all\n* copies or substantial portions of the Software.\n*\n* THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n* SOFTWARE.\n*/\n\nimport { BluetoothDevice } from \"./device\";\nimport { getServiceUUID } from \"./helpers\";\nimport { adapter } from \"./adapter\";\nimport { W3CBluetoothRemoteGATTServer } from \"./interfaces\";\nimport { BluetoothRemoteGATTService } from \"./service\";\nimport { DOMEvent } from \"./events\";\n\n/**\n * Bluetooth Remote GATT Server class\n */\nexport class BluetoothRemoteGATTServer implements W3CBluetoothRemoteGATTServer {\n\n    /**\n     * The device the gatt server is related to\n     */\n    public readonly device: BluetoothDevice = null;\n\n    private _connected: boolean = false;\n    /**\n     * Whether the gatt server is connected\n     */\n    public get connected(): boolean {\n        return this._connected;\n    }\n\n    private handle: string = null;\n    private services: Array<BluetoothRemoteGATTService> = null;\n\n    /**\n     * Server constructor\n     * @param device Device the gatt server relates to\n     */\n    constructor(device: BluetoothDevice) {\n        this.device = device;\n        this.handle = this.device.id;\n    }\n\n    /**\n     * Connect the gatt server\n     * @returns Promise containing the gatt server\n     */\n    public connect(): Promise<BluetoothRemoteGATTServer> {\n        return new Promise((resolve, reject) => {\n            if (this.connected) return reject(\"connect error: device already connected\");\n\n            adapter.connect(this.handle, () => {\n                this._connected = true;\n                resolve(this);\n            }, () => {\n                this.services = null;\n                this._connected = false;\n                this.device.dispatchEvent(new DOMEvent(this.device, \"gattserverdisconnected\"));\n                this.device._bluetooth.dispatchEvent(new DOMEvent(this.device, \"gattserverdisconnected\"));\n            }, error => {\n                reject(`connect Error: ${error}`);\n            });\n        });\n    }\n\n    /**\n     * Disconnect the gatt server\n     */\n    public disconnect() {\n        adapter.disconnect(this.handle);\n        this._connected = false;\n    }\n\n    /**\n     * Gets a single primary service contained in the gatt server\n     * @param service service UUID\n     * @returns Promise containing the service\n     */\n    public getPrimaryService(service: string | number): Promise<BluetoothRemoteGATTService> {\n        return new Promise((resolve, reject) => {\n            if (!this.connected) return reject(\"getPrimaryService error: device not connected\");\n            if (!service) return reject(\"getPrimaryService error: no service specified\");\n\n            this.getPrimaryServices(service)\n            .then(services => {\n                if (services.length !== 1) return reject(\"getPrimaryService error: service not found\");\n                resolve(services[0]);\n            })\n            .catch(error => {\n                reject(`getPrimaryService error: ${error}`);\n            });\n        });\n    }\n\n    /**\n     * Gets a list of primary services contained in the gatt server\n     * @param service service UUID\n     * @returns Promise containing an array of services\n     */\n    public getPrimaryServices(service?: string | number): Promise<Array<BluetoothRemoteGATTService>> {\n        return new Promise((resolve, reject) => {\n            if (!this.connected) return reject(\"getPrimaryServices error: device not connected\");\n\n            function complete() {\n                if (!service) return resolve(this.services);\n\n                const filtered = this.services.filter(serviceObject => {\n                    return (serviceObject.uuid === getServiceUUID(service));\n                });\n\n                if (filtered.length !== 1) return reject(\"getPrimaryServices error: service not found\");\n                resolve(filtered);\n            }\n\n            if (this.services) return complete.call(this);\n\n            adapter.discoverServices(this.handle, this.device._allowedServices, services => {\n                this.services = services.map(serviceInfo => {\n                    Object.assign(serviceInfo, {\n                        device: this.device\n                    });\n                    return new BluetoothRemoteGATTService(serviceInfo);\n                });\n\n                complete.call(this);\n            }, error => {\n                reject(`getPrimaryServices error: ${error}`);\n            });\n        });\n    }\n}\n","/*\n* Node Web Bluetooth\n* Copyright (c) 2017 Rob Moran\n*\n* The MIT License (MIT)\n*\n* Permission is hereby granted, free of charge, to any person obtaining a copy\n* of this software and associated documentation files (the \"Software\"), to deal\n* in the Software without restriction, including without limitation the rights\n* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n* copies of the Software, and to permit persons to whom the Software is\n* furnished to do so, subject to the following conditions:\n*\n* The above copyright notice and this permission notice shall be included in all\n* copies or substantial portions of the Software.\n*\n* THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n* SOFTWARE.\n*/\n\nimport { EventDispatcher, TypedDispatcher } from \"./dispatcher\";\nimport { Bluetooth } from \"./bluetooth\";\nimport { BluetoothRemoteGATTServer } from \"./server\";\nimport { BluetoothRemoteGATTServiceEvents } from \"./service\";\nimport { W3CBluetoothDevice } from \"./interfaces\";\n\n/**\n * @hidden\n */\nexport interface BluetoothDeviceEvents extends BluetoothRemoteGATTServiceEvents {\n    /**\n     * GATT server disconnected event\n     */\n    gattserverdisconnected: Event;\n    /**\n     * Advertisement received event\n     */\n    advertisementreceived: Event;\n}\n\n/**\n * Bluetooth Device class\n */\nexport class BluetoothDevice extends (EventDispatcher as new() => TypedDispatcher<BluetoothDeviceEvents>) implements W3CBluetoothDevice {\n\n    /**\n     * The unique identifier of the device\n     */\n    public readonly id: string = null;\n\n    /**\n     * The name of the device\n     */\n    public readonly name: string = null;\n\n    /**\n     * The gatt server of the device\n     */\n    public readonly gatt: BluetoothRemoteGATTServer = null;\n\n    /**\n     * Whether adverts are being watched (not implemented)\n     */\n    public readonly watchingAdvertisements: boolean = false;\n\n    /**\n     * @hidden\n     */\n    public readonly adData: {\n        rssi?: number;\n        txPower?: number;\n        serviceData?: Map<string, DataView>;\n        manufacturerData?: Map<string, DataView>;\n    };\n\n    /**\n     * @hidden\n     */\n    public readonly _bluetooth: Bluetooth = null;\n\n    /**\n     * @hidden\n     */\n    public readonly _allowedServices: Array<string> = [];\n\n    /**\n     * @hidden\n     */\n    public readonly _serviceUUIDs: Array<string> = [];\n\n    private _oncharacteristicvaluechanged: (ev: Event) => void;\n    public set oncharacteristicvaluechanged(fn: (ev: Event) => void) {\n        if (this._oncharacteristicvaluechanged) {\n            this.removeEventListener(\"characteristicvaluechanged\", this._oncharacteristicvaluechanged);\n        }\n        this._oncharacteristicvaluechanged = fn;\n        this.addEventListener(\"characteristicvaluechanged\", this._oncharacteristicvaluechanged);\n    }\n\n    private _onserviceadded: (ev: Event) => void;\n    public set onserviceadded(fn: (ev: Event) => void) {\n        if (this._onserviceadded) {\n            this.removeEventListener(\"serviceadded\", this._onserviceadded);\n        }\n        this._onserviceadded = fn;\n        this.addEventListener(\"serviceadded\", this._onserviceadded);\n    }\n\n    private _onservicechanged: (ev: Event) => void;\n    public set onservicechanged(fn: (ev: Event) => void) {\n        if (this._onservicechanged) {\n            this.removeEventListener(\"servicechanged\", this._onservicechanged);\n        }\n        this._onservicechanged = fn;\n        this.addEventListener(\"servicechanged\", this._onservicechanged);\n    }\n\n    private _onserviceremoved: (ev: Event) => void;\n    public set onserviceremoved(fn: (ev: Event) => void) {\n        if (this._onserviceremoved) {\n            this.removeEventListener(\"serviceremoved\", this._onserviceremoved);\n        }\n        this._onserviceremoved = fn;\n        this.addEventListener(\"serviceremoved\", this._onserviceremoved);\n    }\n\n    private _ongattserverdisconnected: (ev: Event) => void;\n    public set ongattserverdisconnected(fn: (ev: Event) => void) {\n        if (this._ongattserverdisconnected) {\n            this.removeEventListener(\"gattserverdisconnected\", this._ongattserverdisconnected);\n        }\n        this._ongattserverdisconnected = fn;\n        this.addEventListener(\"gattserverdisconnected\", this._ongattserverdisconnected);\n    }\n\n    private _onadvertisementreceived: (ev: Event) => void;\n    public set onadvertisementreceived(fn: (ev: Event) => void) {\n        if (this._onadvertisementreceived) {\n            this.removeEventListener(\"advertisementreceived\", this._onadvertisementreceived);\n        }\n        this._onadvertisementreceived = fn;\n        this.addEventListener(\"advertisementreceived\", this._onadvertisementreceived);\n    }\n\n    /**\n     * Device constructor\n     * @param init A partial class to initialise values\n     */\n    constructor(init: Partial<BluetoothDevice>) {\n        super();\n\n        this.id = init.id;\n        this.name = init.name;\n        this.gatt = init.gatt;\n        this.watchAdvertisements = init.watchAdvertisements;\n        this.adData = init.adData;\n\n        this._bluetooth = init._bluetooth;\n        this._allowedServices = init._allowedServices;\n        this._serviceUUIDs = init._serviceUUIDs;\n\n        if (!this.name) this.name = `Unknown or Unsupported Device (${this.id})`;\n        if (!this.gatt) this.gatt = new BluetoothRemoteGATTServer(this);\n    }\n\n    /**\n     * Starts watching adverts from this device (not implemented)\n     */\n    public watchAdvertisements(): Promise<void> {\n        return new Promise((_resolve, reject) => {\n            reject(\"watchAdvertisements error: method not implemented\");\n        });\n    }\n\n    /**\n     * Stops watching adverts from this device (not implemented)\n     */\n    public unwatchAdvertisements() {\n        return new Promise((_resolve, reject) => {\n            reject(\"unwatchAdvertisements error: method not implemented\");\n        });\n    }\n}\n","/*\n* Node Web Bluetooth\n* Copyright (c) 2017 Rob Moran\n*\n* The MIT License (MIT)\n*\n* Permission is hereby granted, free of charge, to any person obtaining a copy\n* of this software and associated documentation files (the \"Software\"), to deal\n* in the Software without restriction, including without limitation the rights\n* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n* copies of the Software, and to permit persons to whom the Software is\n* furnished to do so, subject to the following conditions:\n*\n* The above copyright notice and this permission notice shall be included in all\n* copies or substantial portions of the Software.\n*\n* THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n* SOFTWARE.\n*/\n\nimport { EventDispatcher, TypedDispatcher } from \"./dispatcher\";\nimport { BluetoothDevice, BluetoothDeviceEvents } from \"./device\";\nimport { getServiceUUID } from \"./helpers\";\nimport { adapter, NobleAdapter } from \"./adapter\";\nimport { W3CBluetooth } from \"./interfaces\";\nimport { DOMEvent } from \"./events\";\n\n/**\n * Bluetooth Options interface\n */\nexport interface BluetoothOptions {\n    /**\n     * A `device found` callback function to allow the user to select a device\n     */\n    deviceFound?: (device: BluetoothDevice, selectFn: () => void) => boolean;\n\n    /**\n     * The amount of seconds to scan for the device (default is 10)\n     */\n    scanTime?: number;\n\n    /**\n     * An optional referring device\n     */\n    referringDevice?: BluetoothDevice;\n}\n\n/**\n * @hidden\n */\nexport interface BluetoothEvents extends BluetoothDeviceEvents {\n    /**\n     * Bluetooth Availability Changed event\n     */\n    availabilitychanged: Event;\n}\n\n/**\n * Bluetooth class\n */\nexport class Bluetooth extends (EventDispatcher as new() => TypedDispatcher<BluetoothEvents>) implements W3CBluetooth {\n\n    /**\n     * Bluetooth Availability Changed event\n     * @event\n     */\n    public static EVENT_AVAILABILITY: string = \"availabilitychanged\";\n\n    /**\n     * Referring device for the bluetooth instance\n     */\n    public readonly referringDevice?: BluetoothDevice;\n\n    private deviceFound: (device: BluetoothDevice, selectFn: () => void) => boolean = null;\n    private scanTime: number = 10.24 * 1000;\n    private scanner = null;\n\n    private _oncharacteristicvaluechanged: (ev: Event) => void;\n    public set oncharacteristicvaluechanged(fn: (ev: Event) => void) {\n        if (this._oncharacteristicvaluechanged) {\n            this.removeEventListener(\"characteristicvaluechanged\", this._oncharacteristicvaluechanged);\n        }\n        this._oncharacteristicvaluechanged = fn;\n        this.addEventListener(\"characteristicvaluechanged\", this._oncharacteristicvaluechanged);\n    }\n\n    private _onserviceadded: (ev: Event) => void;\n    public set onserviceadded(fn: (ev: Event) => void) {\n        if (this._onserviceadded) {\n            this.removeEventListener(\"serviceadded\", this._onserviceadded);\n        }\n        this._onserviceadded = fn;\n        this.addEventListener(\"serviceadded\", this._onserviceadded);\n    }\n\n    private _onservicechanged: (ev: Event) => void;\n    public set onservicechanged(fn: (ev: Event) => void) {\n        if (this._onservicechanged) {\n            this.removeEventListener(\"servicechanged\", this._onservicechanged);\n        }\n        this._onservicechanged = fn;\n        this.addEventListener(\"servicechanged\", this._onservicechanged);\n    }\n\n    private _onserviceremoved: (ev: Event) => void;\n    public set onserviceremoved(fn: (ev: Event) => void) {\n        if (this._onserviceremoved) {\n            this.removeEventListener(\"serviceremoved\", this._onserviceremoved);\n        }\n        this._onserviceremoved = fn;\n        this.addEventListener(\"serviceremoved\", this._onserviceremoved);\n    }\n\n    private _ongattserverdisconnected: (ev: Event) => void;\n    public set ongattserverdisconnected(fn: (ev: Event) => void) {\n        if (this._ongattserverdisconnected) {\n            this.removeEventListener(\"gattserverdisconnected\", this._ongattserverdisconnected);\n        }\n        this._ongattserverdisconnected = fn;\n        this.addEventListener(\"gattserverdisconnected\", this._ongattserverdisconnected);\n    }\n\n    private _onadvertisementreceived: (ev: Event) => void;\n    public set onadvertisementreceived(fn: (ev: Event) => void) {\n        if (this._onadvertisementreceived) {\n            this.removeEventListener(\"advertisementreceived\", this._onadvertisementreceived);\n        }\n        this._onadvertisementreceived = fn;\n        this.addEventListener(\"advertisementreceived\", this._onadvertisementreceived);\n    }\n\n    private _onavailabilitychanged: (ev: Event) => void;\n    public set onavailabilitychanged(fn: (ev: Event) => void) {\n        if (this._onavailabilitychanged) {\n            this.removeEventListener(\"availabilitychanged\", this._onavailabilitychanged);\n        }\n        this._onavailabilitychanged = fn;\n        this.addEventListener(\"availabilitychanged\", this._onavailabilitychanged);\n    }\n\n    /**\n     * Bluetooth constructor\n     * @param options Bluetooth initialisation options\n     */\n    constructor(options?: BluetoothOptions) {\n        super();\n\n        options = options || {};\n        this.referringDevice = options.referringDevice;\n        this.deviceFound = options.deviceFound;\n        if (options.scanTime) this.scanTime = options.scanTime * 1000;\n\n        adapter.on(NobleAdapter.EVENT_ENABLED, _value => {\n            this.dispatchEvent(new DOMEvent(this, \"availabilitychanged\"));\n        });\n    }\n\n    private filterDevice(filters: Array<BluetoothRequestDeviceFilter>, deviceInfo, validServices) {\n        let valid = false;\n\n        filters.forEach(filter => {\n            // Name\n            if (filter.name && filter.name !== deviceInfo.name) return;\n\n            // NamePrefix\n            if (filter.namePrefix) {\n                if (!deviceInfo.name || filter.namePrefix.length > deviceInfo.name.length) return;\n                if (filter.namePrefix !== deviceInfo.name.substr(0, filter.namePrefix.length)) return;\n            }\n\n            // Services\n            if (filter.services) {\n                const serviceUUIDs = filter.services.map(getServiceUUID);\n                const servicesValid = serviceUUIDs.every(serviceUUID => {\n                    return (deviceInfo._serviceUUIDs.indexOf(serviceUUID) > -1);\n                });\n\n                if (!servicesValid) return;\n                validServices = validServices.concat(serviceUUIDs);\n            }\n\n            valid = true;\n        });\n\n        if (!valid) return false;\n        return deviceInfo;\n    }\n\n    /**\n     * Gets the availability of a bluetooth adapter\n     * @returns Promise containing a flag indicating bluetooth availability\n     */\n    public getAvailability(): Promise<boolean> {\n        return new Promise((resolve, _reject) => {\n            adapter.getEnabled(enabled => {\n                resolve(enabled);\n            });\n        });\n    }\n\n    /**\n     * Scans for a device matching optional filters\n     * @param options The options to use when scanning\n     * @returns Promise containing a device which matches the options\n     */\n    public requestDevice(options: RequestDeviceOptions = { filters: [] }): Promise<BluetoothDevice> {\n        return new Promise((resolve, reject) => {\n\n            if (this.scanner !== null) return reject(\"requestDevice error: request in progress\");\n\n            interface Filtered {\n                filters: Array<BluetoothRequestDeviceFilter>;\n                optionalServices?: Array<BluetoothServiceUUID>;\n            }\n\n            interface AcceptAll {\n                acceptAllDevices: boolean;\n                optionalServices?: Array<BluetoothServiceUUID>;\n            }\n\n            const isFiltered = (maybeFiltered: RequestDeviceOptions): maybeFiltered is Filtered =>\n                (maybeFiltered as Filtered).filters !== undefined;\n\n            const isAcceptAll = (maybeAcceptAll: RequestDeviceOptions): maybeAcceptAll is AcceptAll =>\n                (maybeAcceptAll as AcceptAll).acceptAllDevices === true;\n\n            let searchUUIDs = [];\n\n            if (isFiltered(options)) {\n                // Must have a filter\n                if (options.filters.length === 0) {\n                    return reject(new TypeError(\"requestDevice error: no filters specified\"));\n                }\n\n                // Don't allow empty filters\n                const emptyFilter = options.filters.some(filter => {\n                    return (Object.keys(filter).length === 0);\n                });\n                if (emptyFilter) {\n                    return reject(new TypeError(\"requestDevice error: empty filter specified\"));\n                }\n\n                // Don't allow empty namePrefix\n                const emptyPrefix = options.filters.some(filter => {\n                    return (typeof filter.namePrefix !== \"undefined\" && filter.namePrefix === \"\");\n                });\n                if (emptyPrefix) {\n                    return reject(new TypeError(\"requestDevice error: empty namePrefix specified\"));\n                }\n\n                options.filters.forEach(filter => {\n                    if (filter.services) searchUUIDs = searchUUIDs.concat(filter.services.map(getServiceUUID));\n\n                    // Unique-ify\n                    searchUUIDs = searchUUIDs.filter((item, index, array) => {\n                        return array.indexOf(item) === index;\n                    });\n                });\n            } else if (!isAcceptAll(options)) {\n                return reject(new TypeError(\"requestDevice error: specify filters or acceptAllDevices\"));\n            }\n\n            let found = false;\n            adapter.startScan(searchUUIDs, deviceInfo => {\n                let validServices = [];\n\n                function complete(bluetoothDevice) {\n                    this.cancelRequest()\n                    .then(() => {\n                        resolve(bluetoothDevice);\n                    });\n                }\n\n                // filter devices if filters specified\n                if (isFiltered(options)) {\n                    deviceInfo = this.filterDevice(options.filters, deviceInfo, validServices);\n                }\n\n                if (deviceInfo) {\n                    found = true;\n\n                    // Add additional services\n                    if (options.optionalServices) {\n                        validServices = validServices.concat(options.optionalServices.map(getServiceUUID));\n                    }\n\n                    // Set unique list of allowed services\n                    const allowedServices = validServices.filter((item, index, array) => {\n                        return array.indexOf(item) === index;\n                    });\n                    Object.assign(deviceInfo, {\n                        _bluetooth: this,\n                        _allowedServices: allowedServices\n                    });\n\n                    const bluetoothDevice = new BluetoothDevice(deviceInfo);\n\n                    function selectFn() {\n                        complete.call(this, bluetoothDevice);\n                    }\n\n                    if (!this.deviceFound || this.deviceFound(bluetoothDevice, selectFn.bind(this)) === true) {\n                        // If no deviceFound function, or deviceFound returns true, resolve with this device immediately\n                        complete.call(this, bluetoothDevice);\n                    }\n                }\n            }, () => {\n                this.scanner = setTimeout(() => {\n                    this.cancelRequest()\n                    .then(() => {\n                        if (!found) reject(\"requestDevice error: no devices found\");\n                    });\n                }, this.scanTime);\n            }, error => reject(`requestDevice error: ${error}`));\n        });\n    }\n\n    /**\n     * Cancels the scan for devices\n     */\n    public cancelRequest(): Promise<void> {\n        return new Promise((resolve, _reject) => {\n            if (this.scanner) {\n                clearTimeout(this.scanner);\n                this.scanner = null;\n                adapter.stopScan();\n            }\n            resolve();\n        });\n    }\n}\n","/*\n* Node Web Bluetooth\n* Copyright (c) 2017 Rob Moran\n*\n* The MIT License (MIT)\n*\n* Permission is hereby granted, free of charge, to any person obtaining a copy\n* of this software and associated documentation files (the \"Software\"), to deal\n* in the Software without restriction, including without limitation the rights\n* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n* copies of the Software, and to permit persons to whom the Software is\n* furnished to do so, subject to the following conditions:\n*\n* The above copyright notice and this permission notice shall be included in all\n* copies or substantial portions of the Software.\n*\n* THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n* SOFTWARE.\n*/\n\nimport { Bluetooth, BluetoothOptions } from \"./bluetooth\";\n\n/**\n * Default bluetooth instance synonymous with `navigator.bluetooth`\n */\nexport const bluetooth = new Bluetooth();\n\n/**\n * Bluetooth class for creating new instances\n */\nexport { Bluetooth, BluetoothOptions };\n\n/**\n * Helper methods and enums\n */\nexport * from \"./helpers\";\n"],"names":["bluetoothServices","bluetoothCharacteristics","bluetoothDescriptors","EventHandlers","EventEmitter","init","call","this","$getMaxListeners","that","undefined","_maxListeners","defaultMaxListeners","emitNone","handler","isFn","self","len","length","listeners","arrayClone","i","emitOne","arg1","emitTwo","arg2","emitThree","arg3","emitMany","args","apply","_addListener","target","type","listener","prepend","m","events","existing","e","TypeError","_events","newListener","emit","_eventsCount","unshift","push","warned","w","Error","name","emitter","count","console","warn","log","_onceWrap","fired","g","removeListener","arguments","listenerCount","evlistener","arr","copy","Array","prototype","Object","create","usingDomains","domain","active","getPrototypeOf","setMaxListeners","n","isNaN","getMaxListeners","er","doError","error","err","context","domainEmitter","domainThrown","addListener","on","prependListener","once","prependOnceListener","list","position","originalListener","index","k","pop","spliceOne","removeAllListeners","key","keys","ret","unwrapListeners","eventNames","Reflect","ownKeys","EventDispatcher","[object Object]","handleEvent","isEventListenerObject","super","callback","event","getCanonicalUUID","uuid","toString","toLowerCase","slice","match","splice","join","getServiceUUID","service","getCharacteristicUUID","characteristic","getDescriptorUUID","descriptor","NobleAdapter","enabled","state","noble.on","EVENT_ENABLED","noble.state","completeFn","initialised","deviceInfo","discoverFn","errorFn","continueFn","delay","setTimeout","buffer","arrayBuffer","Uint8Array","DataView","dataView","typedArray","Buffer","serviceUUIDs","advertisement","serviceUuids","advertisedUUIDs","map","serviceUUID","some","indexOf","deviceID","address","id","forEach","manufacturerData","Map","company","readUInt16LE","set","bufferToDataView","serviceData","serviceAdvert","data","localName","_serviceUUIDs","adData","rssi","txPower","txPowerLevel","stateCB","noble[\"once\"]","bind","foundFn","validDevice","device","deviceToBluetoothDevice","deviceHandles","noble.startScanning","checkForError","_errorFn","noble.stopScanning","handle","connectFn","disconnectFn","baseDevice","serviceHandles","characteristicHandles","descriptorHandles","charNotifies","connect","disconnect","discoverServices","services","discovered","serviceInfo","primary","discoverIncludedServices","characteristicUUIDs","discoverCharacteristics","characteristics","characteristicInfo","charUUID","properties","broadcast","read","writeWithoutResponse","write","notify","indicate","authenticatedSignedWrites","reliableWrite","writableAuxiliaries","isNotification","descriptorUUIDs","discoverDescriptors","descriptors","descriptorInfo","descUUID","descHandle","value","withoutResponse","dataViewToBuffer","os","notifyFn","readValue","writeValue","adapter","BluetoothRemoteGATTDescriptor","_value","Promise","resolve","reject","gatt","connected","readDescriptor","writeDescriptor","DOMEvent","srcElement","currentTarget","bubbles","cancelable","defaultPrevented","BluetoothRemoteGATTCharacteristic","oncharacteristicvaluechanged","fn","_oncharacteristicvaluechanged","removeEventListener","addEventListener","dispatchEvent","_bluetooth","getDescriptors","then","catch","complete","filtered","filter","descriptorObject","assign","readCharacteristic","setValue","writeCharacteristic","enableNotify","disableNotify","BluetoothRemoteGATTService","isPrimary","onserviceadded","_onserviceadded","onservicechanged","_onservicechanged","onserviceremoved","_onserviceremoved","getCharacteristics","characteristicObject","getIncludedServices","serviceObject","_allowedServices","BluetoothRemoteGATTServer","_connected","getPrimaryServices","BluetoothDevice","watchAdvertisements","ongattserverdisconnected","_ongattserverdisconnected","onadvertisementreceived","_onadvertisementreceived","_resolve","Bluetooth","options","referringDevice","deviceFound","scanTime","onavailabilitychanged","_onavailabilitychanged","filters","validServices","valid","namePrefix","substr","every","concat","_reject","getEnabled","scanner","isFiltered","maybeFiltered","searchUUIDs","item","array","acceptAllDevices","found","startScan","bluetoothDevice","cancelRequest","filterDevice","optionalServices","allowedServices","clearTimeout","stopScan","bluetooth"],"mappings":"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,EAAkBC,GAM9B,MAJ0B,iBAAfA,GAA2B1H,uBAAqB0H,KACvDA,EAAa1H,uBAAqB0H,IAG/Bb,EAAiBa,IAnRhB5H,EAAAA,sBAAAA,yEAERA,wCACAA,4CACAA,0CACAA,8CACAA,4CACAA,wEACAA,sCACAA,wCACAA,gEACAA,kDACAA,wDACAA,0CACAA,gDACAA,4BACAA,kDACAA,kCACAA,0DACAA,4CACAA,kDACAA,gEACAA,gCACAA,4DACAA,4CACAA,kDACAA,0CACAA,wDACAA,gEACAA,4CACAA,8BACAA,gCACAA,uCAMQC,EAAAA,6BAAAA,yGAERA,2EACAA,iDACAA,qBACAA,iCACAA,iDACAA,mEACAA,qCACAA,+EACAA,uCACAA,+BACAA,+EACAA,+EACAA,qDACAA,2BACAA,6DACAA,qDACAA,8CACAA,iEACAA,yCACAA,2DACAA,mEACAA,+DACAA,uEACAA,uDACAA,yEACAA,6DACAA,mEACAA,qEACAA,6DACAA,8FACAA,qCACAA,6CACAA,uDACAA,2DACAA,2EACAA,mCACAA,qCACAA,6CACAA,uCACAA,qEACAA,yDACAA,iEACAA,uDACAA,iEACAA,yCACAA,uEACAA,iCACAA,yCACAA,qCACAA,+DACAA,gDACAA,iCACAA,6BACAA,mCACAA,iCACAA,yCACAA,2CACAA,6EACAA,6EACAA,+DACAA,mCACAA,qEACAA,uCACAA,2BACAA,6CACAA,qDACAA,qEACAA,qCACAA,+DACAA,+DACAA,2CACAA,2DACAA,mCACAA,2BACAA,iDACAA,6CACAA,iDACAA,+BACAA,wHACAA,+EACAA,qEACAA,+DACAA,mCACAA,+BACAA,iCACAA,+BACAA,+CACAA,mCACAA,oEACAA,2DACAA,2DACAA,mDACAA,yCACAA,iCACAA,uDACAA,+DACAA,+DACAA,+DACAA,2EACAA,uDACAA,qDACAA,mCACAA,iCACAA,8GACAA,wEACAA,mEACAA,uCACAA,mEACAA,2BACAA,uDACAA,+CACAA,+BACAA,yCACAA,+BACAA,kEACAA,qEACAA,mEACAA,2BACAA,mCACAA,mDACAA,uDACAA,2CACAA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"}